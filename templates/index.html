<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScreenSage</title>
    <link rel="icon" type="image/png" href="/static/Images/movie_icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Raleway:ital,wght@0,100..900;1,100..900&family=Shadows+Into+Light&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Raleway", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            overflow-x: hidden;
        }
        
        .description-text {
            font-family: "Jost", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
        }
        
        /* Blurred background slideshow */
        .background-slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
            overflow: hidden;
        }
        
        .background-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 2s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(2px) brightness(0.3);
            /* Ensure proper aspect ratio for 1920x1080 images */
            min-height: 100vh;
            min-width: 100vw;
        }
        
        .background-slide.active {
            opacity: 1;
        }
        
        /* Overlay for better text readability */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }
        
        /* Content sections */
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            z-index: 1;
        }
        
        .search-section {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(17, 24, 39, 0.95));
            backdrop-filter: blur(20px);
            position: relative;
            z-index: 1;
        }
        
        /* Enhanced movie card styles */
        .movie-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.3);
            cursor: pointer;
        }
        .movie-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        .movie-card img {
            transition: transform 0.3s ease;
        }
        .movie-card:hover img {
            transform: scale(1.05);
        }
        .platform-badge {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
        }
        .cast-item {
            font-size: 0.875rem;
            color: #D1D5DB;
            margin-bottom: 2px;
        }
        .summary-text {
            line-height: 1.6;
            color: #E5E7EB;
        }
        .rating-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .release-date {
            color: #9CA3AF;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }
        .director-info {
            color: #D1D5DB;
            font-size: 0.875rem;
            margin-bottom: 8px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        .modal-header {
            position: relative;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            padding: 20px;
            border-radius: 20px 20px 0 0;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        }
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            color: #9CA3AF;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 10;
        }
        .close:hover {
            color: #EF4444;
        }
        .modal-body {
            padding: 30px;
        }
        .movie-detail-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            align-items: start;
        }
        .movie-poster-large {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .movie-info-section {
            margin-bottom: 25px;
        }
        .movie-info-section h3 {
            color: #3B82F6;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            padding-bottom: 5px;
        }
        .full-summary {
            background: rgba(17, 24, 39, 0.5);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3B82F6;
            margin-top: 15px;
        }
        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .cast-card {
            background: rgba(17, 24, 39, 0.5);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        .cast-name {
            font-weight: 600;
            color: #E5E7EB;
        }
        .cast-character {
            color: #9CA3AF;
            font-size: 0.875rem;
        }
        .platform-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .platform-badge-large {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.875rem;
            font-weight: 500;
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* Feature cards */
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        /* Stats cards */
        .stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* Scroll indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }
        
        /* Search input styles */
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
            border-color: #3B82F6;
        }
        
        @media (max-width: 768px) {
            .movie-detail-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .modal-content {
                margin: 5% auto;
                width: 95%;
                max-height: 95vh;
            }
            .cast-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-black text-white">

    <!-- Background Slideshow -->
    <div class="background-slideshow">
        <div class="background-slide active" style="background-image: url('/Images/Poster/Wolf.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/MIB.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/avatar.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/1.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/2.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/3.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/4.webp');"></div>
        <div class="background-slide" style="background-image: url('/Images/Poster/5.webp');"></div>
    </div>
    
    <!-- Background Overlay -->
    <div class="background-overlay"></div>

    <!-- Hero Section - Full Page Description -->
    <section class="hero-section">
        <div class="pl-8">
            <div class="max-w-4xl">
                <!-- Logo and Title -->
                <div class="flex items-center mb-8">
                    <img src="/static/Images/movie_icon.png" alt="Movie Icon" class="w-16 h-16 mr-4">
                    <h1 class="text-5xl md:text-7xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                        ScreenSage
                    </h1>
                </div>
                
                <!-- Main Description -->
                <div class="space-y-8">
                    <p class="description-text text-xl md:text-2xl text-gray-300 leading-relaxed mb-8">
                        Welcome to ScreenSage üé¨‚ú®<br><br>
                        Finding the right movie has never been easier! Our smart recommendation platform suggests films based on what you search, helping you discover hidden gems and timeless classics that match your taste.<br><br>
                        Simply search for a movie, and not only will we suggest similar titles you'll love, but we'll also give you a clear and concise summary of your chosen film‚Äîso you know exactly what to expect before hitting play. Whether you're in the mood for thrillers, comedies, dramas, or something totally unexpected, ScreenSage is your personal guide to the perfect movie night. üçø
                    </p>
                    
                    <!-- Call to Action -->
                    <div>
                        <p class="text-lg text-gray-300 mb-6">Ready to discover your next favorite movie?</p>
                        <a href="#search" class="inline-block px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full font-semibold text-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                            Start Your Journey
                        </a>
                    </div>
                </div>
                
                <!-- Scroll Indicator -->
                <div class="scroll-indicator">
                    <div class="text-gray-400">
                        <div class="text-sm mb-2">Scroll to search</div>
                        <svg class="w-6 h-6 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section id="search" class="search-section">
        <div class="container mx-auto px-4 py-16">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl md:text-5xl font-bold mb-8 text-gray-100">
                    Find Your Next Favorite Movie
                </h2>
                <p class="text-xl text-gray-300 mb-12">
                    Search for a movie and get detailed recommendations with cast, streaming info, and summaries.
                </p>

                <form id="search-form" class="relative max-w-2xl mx-auto mb-8">
                    <input 
                        id="search-input"
                        type="text" 
                        list="movie-titles"
                        placeholder="Search for a movie..." 
                        class="search-input w-full p-4 pr-12 text-lg bg-black border-2 border-gray-600 rounded-full text-white placeholder-gray-400 transition-all duration-300"
                    >
                    <datalist id="movie-titles"></datalist>
                    <button type="submit" class="absolute right-5 top-1/2 -translate-y-1/2 h-6 w-6 text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </form>

                <!-- Movie Recommendations Section -->
                <div id="recommendations-container" class="w-full">
                    <div id="loader" class="hidden text-center">
                         <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          <p class="text-gray-300 mt-4">Generating detailed recommendations with summaries...</p>
                    </div>
                    <!-- Enhanced grid layout for detailed movie cards -->
                    <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Movie Detail Modal -->
    <div id="movieModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2 id="modalTitle" class="text-2xl font-bold text-gray-100"></h2>
            </div>
            <div class="modal-body">
                <div class="movie-detail-grid">
                    <div class="movie-poster-section">
                        <img id="modalPoster" src="" alt="Movie Poster" class="movie-poster-large">
                        <div class="mt-4 text-center">
                            <div id="modalRating" class="text-lg font-semibold text-green-400 mb-2"></div>
                            <div id="modalReleaseDate" class="text-gray-400"></div>
                        </div>
                    </div>
                    
                    <div class="movie-details-section">
                        <!-- Basic Info -->
                        <div class="movie-info-section">
                            <h3>üìΩÔ∏è Movie Information</h3>
                            <div id="modalBasicInfo" class="text-gray-300"></div>
                        </div>

                        <!-- Cast -->
                        <div class="movie-info-section">
                            <h3>üé≠ Cast & Characters</h3>
                            <div id="modalCast" class="cast-grid"></div>
                        </div>

                        <!-- Streaming Platforms -->
                        <div class="movie-info-section">
                            <h3>üì∫ Available On</h3>
                            <div id="modalPlatforms" class="platform-grid"></div>
                        </div>

                        <!-- Full AI Summary -->
                        <div class="movie-info-section">
                            <h3>ü§ñ Summary</h3>
                            <div id="modalSummary" class="full-summary">
                                <p id="modalSummaryText" class="summary-text"></p>
                            </div>
                        </div>

                        <!-- Original Overview -->
                        <div class="movie-info-section">
                            <h3>üìñ Original Overview</h3>
                            <div class="full-summary">
                                <p id="modalOverview" class="summary-text"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Background slideshow functionality
        const backgroundSlides = document.querySelectorAll('.background-slide');
        let currentBackgroundSlide = 0;

        // Debug: Check if images are loading
        backgroundSlides.forEach((slide, index) => {
            const bgImage = slide.style.backgroundImage;
            const url = bgImage.replace('url(', '').replace(')', '').replace(/"/g, '');
            console.log(`Background ${index}: ${url}`);
            
            // Test image loading
            const img = new Image();
            img.onload = () => console.log(`‚úÖ Background ${index} loaded successfully`);
            img.onerror = () => console.log(`‚ùå Background ${index} failed to load: ${url}`);
            img.src = url;
        });

        function showBackgroundSlide(index) {
            backgroundSlides.forEach(slide => slide.classList.remove('active'));
            backgroundSlides[index].classList.add('active');
            console.log(`Showing background slide ${index}`);
        }

        function nextBackgroundSlide() {
            currentBackgroundSlide = (currentBackgroundSlide + 1) % backgroundSlides.length;
            showBackgroundSlide(currentBackgroundSlide);
        }

        // Auto-advance background slides
        setInterval(nextBackgroundSlide, 5000);

        // Search functionality
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const resultsDiv = document.getElementById('results');
        const loader = document.getElementById('loader');
        const movieTitlesDatalist = document.getElementById('movie-titles');
        
        // Modal elements
        const modal = document.getElementById('movieModal');
        const closeBtn = document.querySelector('.close');
        const modalTitle = document.getElementById('modalTitle');
        const modalPoster = document.getElementById('modalPoster');
        const modalRating = document.getElementById('modalRating');
        const modalReleaseDate = document.getElementById('modalReleaseDate');
        const modalBasicInfo = document.getElementById('modalBasicInfo');
        const modalCast = document.getElementById('modalCast');
        const modalPlatforms = document.getElementById('modalPlatforms');
        const modalSummaryText = document.getElementById('modalSummaryText');
        const modalOverview = document.getElementById('modalOverview');

        let currentMovies = []; // Store current recommendations

        async function populateMovieTitles() {
            try {
                const response = await fetch('/movies');
                const titles = await response.json();
                titles.forEach(title => {
                    const option = document.createElement('option');
                    option.value = title;
                    movieTitlesDatalist.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to fetch movie titles:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', populateMovieTitles);

        searchForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const movieTitle = searchInput.value.trim();
            if (!movieTitle) return;

            resultsDiv.innerHTML = '';
            loader.classList.remove('hidden');

            try {
                const response = await fetch('/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ movie: movieTitle }),
                });

                const data = await response.json();
                loader.classList.add('hidden');

                if (response.ok) {
                    currentMovies = data.recommendations;
                    displayRecommendations(currentMovies);
                } else {
                    displayError(data.error || 'An unknown error occurred.');
                }
            } catch (error) {
                loader.classList.add('hidden');
                displayError('Could not connect to the server. Please try again later.');
                console.error('Fetch Error:', error);
            }
        });

        // Enhanced function to display detailed movie cards
        function displayRecommendations(movies) {
            if (!movies || movies.length === 0) {
                displayError('No recommendations found.');
                return;
            }
            
            movies.forEach((movie, index) => {
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card rounded-xl shadow-lg overflow-hidden';
                movieCard.setAttribute('data-movie-index', index);
                movieCard.addEventListener('click', () => openMovieModal(index));
                
                // Format release date
                const releaseDate = movie.release_date !== 'Unknown' ? 
                    new Date(movie.release_date).getFullYear() : 'Unknown';
                
                // Format runtime
                const runtime = movie.runtime ? `${Math.floor(movie.runtime / 60)}h ${movie.runtime % 60}m` : 'Unknown';
                
                // Create streaming platforms badges
                const platformBadges = movie.streaming_platforms.map(platform => 
                    `<span class="platform-badge">${platform}</span>`
                ).join('');
                
                // Create cast list (shortened for card)
                const castList = movie.cast.slice(0, 3).map(actor => 
                    `<div class="cast-item">‚Ä¢ ${actor.name} as ${actor.character}</div>`
                ).join('');
                
                movieCard.innerHTML = `
                    <div class="relative">
                        <img src="${movie.poster}" alt="${movie.title} Poster" class="w-full h-80 object-cover">
                        ${movie.vote_average ? `<div class="rating-badge">‚òÖ ${movie.vote_average}</div>` : ''}
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-100 mb-2">${movie.title}</h3>
                        
                        <div class="release-date">
                            üìÖ ${releaseDate} ‚Ä¢ ‚è±Ô∏è ${runtime}
                        </div>
                        
                        <div class="director-info">
                            üé¨ Directed by: ${movie.director}
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-300 mb-2">Available on:</h4>
                            <div class="flex flex-wrap gap-1">
                                ${platformBadges}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-300 mb-2">Main Cast:</h4>
                            <div class="text-sm">
                                ${castList}
                                ${movie.cast.length > 3 ? '<div class="cast-item text-blue-400">Click to see more...</div>' : ''}
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <span class="text-blue-400 font-semibold text-sm">Click to view full details & summary</span>
                        </div>
                    </div>
                `;
                
                resultsDiv.appendChild(movieCard);
            });
        }

        // Function to open movie modal
        async function openMovieModal(movieIndex) {
            const movie = currentMovies[movieIndex];
            if (!movie) return;

            // Set modal content
            modalTitle.textContent = movie.title;
            modalPoster.src = movie.poster;
            modalPoster.alt = `${movie.title} Poster`;
            
            // Rating
            if (movie.vote_average) {
                modalRating.innerHTML = `‚òÖ ${movie.vote_average}/10`;
            } else {
                modalRating.innerHTML = '‚òÖ Rating not available';
            }
            
            // Release date
            const releaseDate = movie.release_date !== 'Unknown' ? 
                new Date(movie.release_date).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }) : 'Release date unknown';
            modalReleaseDate.textContent = releaseDate;
            
            // Basic info
            const runtime = movie.runtime ? `${Math.floor(movie.runtime / 60)}h ${movie.runtime % 60}m` : 'Unknown';
            modalBasicInfo.innerHTML = `
                <p><strong>Director:</strong> ${movie.director}</p>
                <p><strong>Runtime:</strong> ${runtime}</p>
                <p><strong>Release Date:</strong> ${releaseDate}</p>
            `;
            
            // Cast
            modalCast.innerHTML = movie.cast.map(actor => `
                <div class="cast-card">
                    <div class="cast-name">${actor.name}</div>
                    <div class="cast-character">as ${actor.character}</div>
                </div>
            `).join('');
            
            // Platforms
            modalPlatforms.innerHTML = movie.streaming_platforms.map(platform => 
                `<span class="platform-badge-large">${platform}</span>`
            ).join('');
            
            // Show loading state for AI summary
            modalSummaryText.innerHTML = `
                <div class="flex items-center justify-center">
                    <svg class="animate-spin h-6 w-6 text-blue-400 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-blue-400">Generating summary...</span>
                </div>
            `;
            
            // Original Overview
            modalOverview.textContent = movie.overview || 'No overview available.';
            
            // Show modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            
            // Fetchfasdfsummary on-demand
            try {
                const response = await fetch('/get_summary', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ movie: movie.title }),
                });
                
                if (response.ok) {
                    const data = await response.json();
                    modalSummaryText.textContent = data.ai_summary;
                } else {
                    modalSummaryText.textContent = 'Failed to generate summary. Showing original overview instead.';
                }
            } catch (error) {
                console.error('Error fetching summary:', error);
                modalSummaryText.textContent = 'Failed to generate summary. Showing original overview instead.';
            }
        }

        // Close modal functions
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Event listeners for closing modal
        closeBtn.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        function displayError(message) {
            resultsDiv.innerHTML = `<div class="col-span-full bg-red-900 bg-opacity-70 text-red-200 p-4 rounded-lg text-center">${message}</div>`;
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });


    </script>
</body>
</html>
